<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Администраторская страница</title>
    <link rel="shortcut icon" href="/img/logo_refhouse%20(5).png" />
    <!-- Подключаем Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-4">

    <h1 class="mb-4"><strong>Страница администратора</strong></h1>

    <!-- Навигационные кнопки -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="forms-tab" data-toggle="tab" href="#forms" role="tab" aria-controls="forms" aria-selected="true">Все заявки</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="queryes-tab" data-toggle="tab" href="#queryes" role="tab" aria-controls="queryes" aria-selected="false">Все отчеты</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="projects-tab" data-toggle="tab" href="#projects" role="tab" aria-controls="projects" aria-selected="false">Все проекты</a>
        </li>
        <!-- Добавлено новое окно "Информация" -->
        <li class="nav-item">
            <a class="nav-link" id="infos-tab" data-toggle="tab" href="#infos" role="tab" aria-controls="infos" aria-selected="false">Информация</a>
        </li>
    </ul>

    <!-- Содержимое с переключаемыми окнами -->
    <div class="tab-content mt-2" id="myTabContent">

        <!-- Заявки -->
        <div class="tab-pane fade show active" id="forms" role="tabpanel" aria-labelledby="forms-tab">
            <div th:each="form : ${forms}" th:sort="${form.createDttm}">
                <span th:text="${form.userFIO + ' - ' + form.phoneNumber + ' - '}"></span><span th:text="${form.getStatus().statusName}" style="font-weight: 700 "></span><span th:text="${' - '+form.getRegion().regionName}" style="font-weight: 700 "></span><span th:text="${' - '+form.createDttm}"></span><span th:if="${form.project != null} and ${form.project.id} != null" th:text="${' - '+form.getProject().projectName}" style="font-weight: 700 "></span><span th:if="${form.calculator != null} and ${form.calculator.id} != null" th:text="${' - '+'Калькулятор'}" style="font-weight: 700 "></span>
                <form th:action="@{editForm/{id}(id=${form.getId()})}" method="get">
                    <button type="submit" class="btn btn-primary">Обработать</button>
                </form>
            </div>
        </div>

        <!-- Отчеты -->
        <div class="tab-pane fade" id="queryes" role="tabpanel" aria-labelledby="queryes-tab">
            <div th:each="query : ${queryes}">
                <div>
                    <a th:href="@{editQuery/{id}(id=${query.getId()})}" th:text="${query.queryName}" class="btn btn-link"></a>
                    <a th:href="@{execute/{id}(id=${query.getId()})}" class="btn btn-info">Посмотреть</a>
                </div>
            </div>
            <a th:href="@{/newQuery.html}">
                <button type="button" class="btn btn-primary">Добавить отчет</button>
            </a>
        </div>

        <!-- Проекты -->
        <div class="tab-pane fade" id="projects" role="tabpanel" aria-labelledby="projects-tab">
            <div th:each="project : ${projects}">
                <p th:text="${project.projectName}"></p>
                <form th:action="@{editProject/{id}(id=${project.getId()})}" method="get">
                    <button type="submit" class="btn btn-success">Редактировать</button>
                </form>
            </div>
            <a th:href="@{/newProject.html}">
                <button type="button" class="btn btn-primary">Добавить проект</button>
            </a>
        </div>

        <!-- Информация -->
        <div class="tab-pane fade" id="infos" role="tabpanel" aria-labelledby="infos-tab">
            <div th:each="info : ${infos}">
                <p th:text="${info.infoName}"></p>
                <form th:action="@{editInfo/{id}(id=${info.getId()})}" method="get">
                    <button type="submit" class="btn btn-success">Редактировать</button>
                </form>
            </div>
            <a th:href="@{/newInfo.html}">
                <button type="button" class="btn btn-primary">Добавить описание</button>
            </a>
        </div>

    </div>
    <!-- Закрываем контейнер для вкладок -->
</div>

<!-- Подключаем Bootstrap JS и зависимости jQuery и Popper.js -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function(){
        // Получаем выбранную вкладку из локального хранилища
        var selectedTab = localStorage.getItem('selectedTab');

        // Если есть сохраненное значение выбранной вкладки, активируем ее
        if (selectedTab) {
            $('#' + selectedTab).tab('show');
        } else {
            // Если нет сохраненной вкладки, активируем вкладку "forms-tab" и сохраняем ее в локальное хранилище
            $('#forms-tab').tab('show');
            localStorage.setItem('selectedTab', 'forms-tab');
        }

        // Обработчик событий для клика по вкладке
        $('.nav-link').on('click', function (e) {
            // Получаем идентификатор вкладки
            var targetTab = $(this).attr('id');
            // Сохраняем id текущей выбранной вкладки в локальное хранилище
            localStorage.setItem('selectedTab', targetTab);
        });
    });
</script>

</body>
</html>
